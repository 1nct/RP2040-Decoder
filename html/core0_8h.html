<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RP2040-Decoder: core0.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RP2040-Decoder
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">core0.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="shared_8h_source.html">shared.h</a>&quot;</code><br />
<code>#include &quot;CV.h&quot;</code><br />
</div>
<p><a href="core0_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a8cbe85a94beae30d747e6a6e85d1ae77" id="r_a8cbe85a94beae30d747e6a6e85d1ae77"><td class="memItemLeft" align="right" valign="top"><a id="a8cbe85a94beae30d747e6a6e85d1ae77" name="a8cbe85a94beae30d747e6a6e85d1ae77"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SIZE_BYTE_ARRAY</b>&#160;&#160;&#160;5</td></tr>
<tr class="separator:a8cbe85a94beae30d747e6a6e85d1ae77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a9a8f8772123235b03debb48fa8a973" id="r_a8a9a8f8772123235b03debb48fa8a973"><td class="memItemLeft" align="right" valign="top"><a id="a8a9a8f8772123235b03debb48fa8a973" name="a8a9a8f8772123235b03debb48fa8a973"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MESSAGE_3_BYTES</b>&#160;&#160;&#160;0b11111111110000000000000000000000000001</td></tr>
<tr class="separator:a8a9a8f8772123235b03debb48fa8a973"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf2f95404177396e3c93496d3b1d709d" id="r_acf2f95404177396e3c93496d3b1d709d"><td class="memItemLeft" align="right" valign="top"><a id="acf2f95404177396e3c93496d3b1d709d" name="acf2f95404177396e3c93496d3b1d709d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MESSAGE_MASK_3_BYTES</b>&#160;&#160;&#160;0b11111111111000000001000000001000000001</td></tr>
<tr class="separator:acf2f95404177396e3c93496d3b1d709d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a884ecc75183e104a60d283a494d163b6" id="r_a884ecc75183e104a60d283a494d163b6"><td class="memItemLeft" align="right" valign="top"><a id="a884ecc75183e104a60d283a494d163b6" name="a884ecc75183e104a60d283a494d163b6"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MESSAGE_4_BYTES</b>&#160;&#160;&#160;0b11111111110000000000000000000000000000000000001</td></tr>
<tr class="separator:a884ecc75183e104a60d283a494d163b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf19b4efd2b349355d55755444620350" id="r_adf19b4efd2b349355d55755444620350"><td class="memItemLeft" align="right" valign="top"><a id="adf19b4efd2b349355d55755444620350" name="adf19b4efd2b349355d55755444620350"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MESSAGE_MASK_4_BYTES</b>&#160;&#160;&#160;0b11111111111000000001000000001000000001000000001</td></tr>
<tr class="separator:adf19b4efd2b349355d55755444620350"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ea7db2e0ad13e6cd1cf221d72d86bb1" id="r_a1ea7db2e0ad13e6cd1cf221d72d86bb1"><td class="memItemLeft" align="right" valign="top"><a id="a1ea7db2e0ad13e6cd1cf221d72d86bb1" name="a1ea7db2e0ad13e6cd1cf221d72d86bb1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MESSAGE_5_BYTES</b>&#160;&#160;&#160;0b11111111110000000000000000000000000000000000000000000001</td></tr>
<tr class="separator:a1ea7db2e0ad13e6cd1cf221d72d86bb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdd45d7e2d818186f88953c361831b55" id="r_acdd45d7e2d818186f88953c361831b55"><td class="memItemLeft" align="right" valign="top"><a id="acdd45d7e2d818186f88953c361831b55" name="acdd45d7e2d818186f88953c361831b55"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MESSAGE_MASK_5_BYTES</b>&#160;&#160;&#160;0b11111111111000000001000000001000000001000000001000000001</td></tr>
<tr class="separator:acdd45d7e2d818186f88953c361831b55"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8db7b95e52c5a24409a057b5354aacac" id="r_a8db7b95e52c5a24409a057b5354aacac"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8db7b95e52c5a24409a057b5354aacac">two_std_dev</a> (const float arr[], uint32_t length)</td></tr>
<tr class="memdesc:a8db7b95e52c5a24409a057b5354aacac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function returns average of values deviating less than twice the standard deviation from original average.  <br /></td></tr>
<tr class="separator:a8db7b95e52c5a24409a057b5354aacac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6501226575466c1d36d7d71ec192ed2" id="r_ad6501226575466c1d36d7d71ec192ed2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad6501226575466c1d36d7d71ec192ed2">adc_offset_adjustment</a> (uint32_t n)</td></tr>
<tr class="memdesc:ad6501226575466c1d36d7d71ec192ed2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Measures ADC offset and saves the offset value to flash memory.  <br /></td></tr>
<tr class="separator:ad6501226575466c1d36d7d71ec192ed2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac87bd6623f47a32e08278afe923477fd" id="r_ac87bd6623f47a32e08278afe923477fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac87bd6623f47a32e08278afe923477fd">acknowledge</a> ()</td></tr>
<tr class="memdesc:ac87bd6623f47a32e08278afe923477fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for acknowledging a CV write or CV verify instruction.  <br /></td></tr>
<tr class="separator:ac87bd6623f47a32e08278afe923477fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc9694833148886687130bfc41c0278b" id="r_afc9694833148886687130bfc41c0278b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afc9694833148886687130bfc41c0278b">verify_cv_bit</a> (uint16_t cv_address, bool bit_val, uint8_t bit_pos)</td></tr>
<tr class="memdesc:afc9694833148886687130bfc41c0278b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for verifying a single bit of a CV.  <br /></td></tr>
<tr class="separator:afc9694833148886687130bfc41c0278b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28319b022b8ee5ff0a38ef2581a4967e" id="r_a28319b022b8ee5ff0a38ef2581a4967e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a28319b022b8ee5ff0a38ef2581a4967e">verify_cv_byte</a> (uint16_t cv_address, uint8_t cv_data)</td></tr>
<tr class="memdesc:a28319b022b8ee5ff0a38ef2581a4967e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for verifying a CV byte.  <br /></td></tr>
<tr class="separator:a28319b022b8ee5ff0a38ef2581a4967e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19046d77097b4236a15890613d6f5300" id="r_a19046d77097b4236a15890613d6f5300"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a19046d77097b4236a15890613d6f5300">write_cv_byte</a> (uint16_t cv_address, uint8_t cv_data)</td></tr>
<tr class="memdesc:a19046d77097b4236a15890613d6f5300"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for writing a CV byte.  <br /></td></tr>
<tr class="separator:a19046d77097b4236a15890613d6f5300"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5036684f11eb837835390659f9e0c4a9" id="r_a5036684f11eb837835390659f9e0c4a9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5036684f11eb837835390659f9e0c4a9">program_mode</a> (uint8_t number_of_bytes, const uint8_t byte_array[])</td></tr>
<tr class="memdesc:a5036684f11eb837835390659f9e0c4a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">CV Programming mode function Used on entering programming mode in order to write CV values to persistent flash memory or verify/read bits/bytes from flash. <br  />
 Refers to NMRA Standard 9.2.3 ("Service Mode Programming") or RCN-216<br  />
  <br /></td></tr>
<tr class="separator:a5036684f11eb837835390659f9e0c4a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a278792ebcab284a57b088283d570957e" id="r_a278792ebcab284a57b088283d570957e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a278792ebcab284a57b088283d570957e">set_outputs</a> (uint32_t functions_to_set_bitmask)</td></tr>
<tr class="memdesc:a278792ebcab284a57b088283d570957e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set outputs according to function mapping in CV257 to CV512.  <br /></td></tr>
<tr class="separator:a278792ebcab284a57b088283d570957e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38173806a6d7c084467c72ce23cc47a2" id="r_a38173806a6d7c084467c72ce23cc47a2"><td class="memItemLeft" align="right" valign="top"><a id="a38173806a6d7c084467c72ce23cc47a2" name="a38173806a6d7c084467c72ce23cc47a2"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>update_active_functions</b> (uint32_t new_function_bitmask, uint8_t clr_bit_ind, bool direction_change)</td></tr>
<tr class="separator:a38173806a6d7c084467c72ce23cc47a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ac1fe49e3a7374fa60cdf3996138b2c" id="r_a9ac1fe49e3a7374fa60cdf3996138b2c"><td class="memItemLeft" align="right" valign="top"><a id="a9ac1fe49e3a7374fa60cdf3996138b2c" name="a9ac1fe49e3a7374fa60cdf3996138b2c"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>error_detection</b> (int8_t number_of_bytes, const uint8_t *byte_array)</td></tr>
<tr class="separator:a9ac1fe49e3a7374fa60cdf3996138b2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c3523e21bb4baefbe045caa9e35c2d7" id="r_a0c3523e21bb4baefbe045caa9e35c2d7"><td class="memItemLeft" align="right" valign="top"><a id="a0c3523e21bb4baefbe045caa9e35c2d7" name="a0c3523e21bb4baefbe045caa9e35c2d7"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>is_long_address</b> (uint8_t number_of_bytes, const uint8_t byte_array[])</td></tr>
<tr class="separator:a0c3523e21bb4baefbe045caa9e35c2d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88ebfc9c05785e606880d290dee9216d" id="r_a88ebfc9c05785e606880d290dee9216d"><td class="memItemLeft" align="right" valign="top"><a id="a88ebfc9c05785e606880d290dee9216d" name="a88ebfc9c05785e606880d290dee9216d"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>address_evaluation</b> (uint8_t number_of_bytes, const uint8_t byte_array[])</td></tr>
<tr class="separator:a88ebfc9c05785e606880d290dee9216d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7c4b425f063f7945344c8209a097eca" id="r_ab7c4b425f063f7945344c8209a097eca"><td class="memItemLeft" align="right" valign="top"><a id="ab7c4b425f063f7945344c8209a097eca" name="ab7c4b425f063f7945344c8209a097eca"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>instruction_evaluation</b> (uint8_t number_of_bytes, const uint8_t byte_array[])</td></tr>
<tr class="separator:ab7c4b425f063f7945344c8209a097eca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ba04419ee6b760e8a19868d3fffc0be" id="r_a0ba04419ee6b760e8a19868d3fffc0be"><td class="memItemLeft" align="right" valign="top"><a id="a0ba04419ee6b760e8a19868d3fffc0be" name="a0ba04419ee6b760e8a19868d3fffc0be"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>reset_message_check</b> (uint8_t number_of_bytes, const uint8_t *const byte_array)</td></tr>
<tr class="separator:a0ba04419ee6b760e8a19868d3fffc0be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe010c2c968965623f9a7409a997b1a8" id="r_afe010c2c968965623f9a7409a997b1a8"><td class="memItemLeft" align="right" valign="top"><a id="afe010c2c968965623f9a7409a997b1a8" name="afe010c2c968965623f9a7409a997b1a8"></a>
int8_t&#160;</td><td class="memItemRight" valign="bottom"><b>verify_dcc_message</b> ()</td></tr>
<tr class="separator:afe010c2c968965623f9a7409a997b1a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac801d52a750572fda6908c63ab265571" id="r_ac801d52a750572fda6908c63ab265571"><td class="memItemLeft" align="right" valign="top"><a id="ac801d52a750572fda6908c63ab265571" name="ac801d52a750572fda6908c63ab265571"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>bits_to_byte_array</b> (int8_t number_of_bytes, uint8_t byte_array[])</td></tr>
<tr class="separator:ac801d52a750572fda6908c63ab265571"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fc8afa31d573a86427f7e73bdb8a07c" id="r_a0fc8afa31d573a86427f7e73bdb8a07c"><td class="memItemLeft" align="right" valign="top"><a id="a0fc8afa31d573a86427f7e73bdb8a07c" name="a0fc8afa31d573a86427f7e73bdb8a07c"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>evaluate_message</b> ()</td></tr>
<tr class="separator:a0fc8afa31d573a86427f7e73bdb8a07c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e63f26cc0e48c67410c6729a3798126" id="r_a9e63f26cc0e48c67410c6729a3798126"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9e63f26cc0e48c67410c6729a3798126">track_signal_rise</a> (unsigned int gpio, long unsigned int events)</td></tr>
<tr class="memdesc:a9e63f26cc0e48c67410c6729a3798126"><td class="mdescLeft">&#160;</td><td class="mdescRight">Track signal rising edge interrupt callback function.  <br /></td></tr>
<tr class="separator:a9e63f26cc0e48c67410c6729a3798126"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8ee69201d93bb812e1fe4f5feadbfdf" id="r_aa8ee69201d93bb812e1fe4f5feadbfdf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa8ee69201d93bb812e1fe4f5feadbfdf">track_signal_fall</a> (unsigned int gpio, long unsigned int events)</td></tr>
<tr class="memdesc:aa8ee69201d93bb812e1fe4f5feadbfdf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Track signal falling edge interrupt callback function.  <br /></td></tr>
<tr class="separator:aa8ee69201d93bb812e1fe4f5feadbfdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10e6b83317f9b22b5264200049a77138" id="r_a10e6b83317f9b22b5264200049a77138"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a10e6b83317f9b22b5264200049a77138">init_outputs</a> ()</td></tr>
<tr class="memdesc:a10e6b83317f9b22b5264200049a77138"><td class="mdescLeft">&#160;</td><td class="mdescRight">Output initialization function.  <br /></td></tr>
<tr class="separator:a10e6b83317f9b22b5264200049a77138"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdf05cec06f673d2763ab0631cbe62f8" id="r_afdf05cec06f673d2763ab0631cbe62f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afdf05cec06f673d2763ab0631cbe62f8">cv_setup_check</a> ()</td></tr>
<tr class="memdesc:afdf05cec06f673d2763ab0631cbe62f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks various CV values in order to detect factory condition or pending calibrations.  <br /></td></tr>
<tr class="separator:afdf05cec06f673d2763ab0631cbe62f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebc81e473ba119c0ce42cacb4efeec69" id="r_aebc81e473ba119c0ce42cacb4efeec69"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aebc81e473ba119c0ce42cacb4efeec69">init_motor_pwm</a> (uint8_t gpio)</td></tr>
<tr class="memdesc:aebc81e473ba119c0ce42cacb4efeec69"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function initializes motor PWM for pin specified.  <br /></td></tr>
<tr class="separator:aebc81e473ba119c0ce42cacb4efeec69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d55adaff96e84bf99460f7c9d24f7a4" id="r_a2d55adaff96e84bf99460f7c9d24f7a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2d55adaff96e84bf99460f7c9d24f7a4">init_adc</a> ()</td></tr>
<tr class="memdesc:a2d55adaff96e84bf99460f7c9d24f7a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes ADC.  <br /></td></tr>
<tr class="separator:a2d55adaff96e84bf99460f7c9d24f7a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3cb7d222f559f6157b67e5b778b3752d" id="r_a3cb7d222f559f6157b67e5b778b3752d"><td class="memItemLeft" align="right" valign="top">const uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3cb7d222f559f6157b67e5b778b3752d">clr_bit_arr</a> [6]</td></tr>
<tr class="memdesc:a3cb7d222f559f6157b67e5b778b3752d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Bitmasks used for clearing bits corresponding to function blocks.  <br /></td></tr>
<tr class="separator:a3cb7d222f559f6157b67e5b778b3752d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Used exclusively by core0 </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ac87bd6623f47a32e08278afe923477fd" name="ac87bd6623f47a32e08278afe923477fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac87bd6623f47a32e08278afe923477fd">&#9670;&#160;</a></span>acknowledge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void acknowledge </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for acknowledging a CV write or CV verify instruction. </p>
<p>Acknowledgement works by creating a spike in current consumption, normally realized by running the motor in alternating directions. This current increase is detected by the command station. Refers to NMRA S-9.2.3 Section D and RCN-216 Section 3 </p>

</div>
</div>
<a id="ad6501226575466c1d36d7d71ec192ed2" name="ad6501226575466c1d36d7d71ec192ed2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6501226575466c1d36d7d71ec192ed2">&#9670;&#160;</a></span>adc_offset_adjustment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adc_offset_adjustment </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>n</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Measures ADC offset and saves the offset value to flash memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">n</td><td>Amount of measurements to be done </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afdf05cec06f673d2763ab0631cbe62f8" name="afdf05cec06f673d2763ab0631cbe62f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdf05cec06f673d2763ab0631cbe62f8">&#9670;&#160;</a></span>cv_setup_check()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cv_setup_check </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks various CV values in order to detect factory condition or pending calibrations. </p>
<p>Procedure:</p><ol type="1">
<li>Check for flash memory factory condition when found write default values specified in <a class="el" href="CV_8h_source.html">CV.h</a> to flash memory</li>
<li>Check for existing ADC offset setup when not found write 7 to read-only CV_7 in order to trigger a ADC offset measurement/calibration</li>
<li>Check for base PWM configuration/calibration, run calibration when none is found </li>
</ol>

</div>
</div>
<a id="a2d55adaff96e84bf99460f7c9d24f7a4" name="a2d55adaff96e84bf99460f7c9d24f7a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d55adaff96e84bf99460f7c9d24f7a4">&#9670;&#160;</a></span>init_adc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_adc </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes ADC. </p>
<p>Function initializes ADC, corresponding GPIO pins and ADC FIFO </p>

</div>
</div>
<a id="aebc81e473ba119c0ce42cacb4efeec69" name="aebc81e473ba119c0ce42cacb4efeec69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebc81e473ba119c0ce42cacb4efeec69">&#9670;&#160;</a></span>init_motor_pwm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_motor_pwm </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>gpio</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function initializes motor PWM for pin specified. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gpio</td><td>GPIO pin </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a10e6b83317f9b22b5264200049a77138" name="a10e6b83317f9b22b5264200049a77138"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10e6b83317f9b22b5264200049a77138">&#9670;&#160;</a></span>init_outputs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_outputs </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Output initialization function. </p>
<p>Initializes all allowed GPIO outputs as outputs <br  />
 Sets PWM functionality for GPIOs configured as PWM pins CV_112 - CV_115 (see <a class="el" href="CV_8h_source.html">CV.h</a> for reference) <br  />
 PWM frequency and clock divider are configured according to CV_116 - CV_171 (see <a class="el" href="CV_8h_source.html">CV.h</a> for reference) <br  />
 </p>

</div>
</div>
<a id="a5036684f11eb837835390659f9e0c4a9" name="a5036684f11eb837835390659f9e0c4a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5036684f11eb837835390659f9e0c4a9">&#9670;&#160;</a></span>program_mode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void program_mode </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>number_of_bytes</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t</td>          <td class="paramname"><span class="paramname"><em>byte_array</em></span>[]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CV Programming mode function Used on entering programming mode in order to write CV values to persistent flash memory or verify/read bits/bytes from flash. <br  />
 Refers to NMRA Standard 9.2.3 ("Service Mode Programming") or RCN-216<br  />
 </p>
<p>Procedure:</p><ol type="1">
<li>Checks for valid programming command</li>
<li>Disables core1 timers</li>
<li>Resets core1</li>
<li>Saves interrupts</li>
<li>Evaluates the type of programming instruction Write byte / Verify byte / Verify bit and runs corresponding function</li>
<li>Restores interrupts</li>
<li>Launch core1</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">number_of_bytes</td><td>Number of bytes in byte_array[] </td></tr>
    <tr><td class="paramname">byte_array</td><td>Pointer to byte_array[] </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a278792ebcab284a57b088283d570957e" name="a278792ebcab284a57b088283d570957e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a278792ebcab284a57b088283d570957e">&#9670;&#160;</a></span>set_outputs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_outputs </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>functions_to_set_bitmask</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set outputs according to function mapping in CV257 to CV512. </p>
<p>This function maps the functions and direction to the mapped outputs configured in CV257 to CV512. Also enables PWM when enabled according to CV112 to CV115.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">functions_to_set_bitmask</td><td>Function bitmask F0 is bit0, F1 is bit1, ... </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa8ee69201d93bb812e1fe4f5feadbfdf" name="aa8ee69201d93bb812e1fe4f5feadbfdf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8ee69201d93bb812e1fe4f5feadbfdf">&#9670;&#160;</a></span>track_signal_fall()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void track_signal_fall </td>
          <td>(</td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>gpio</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long unsigned int</td>          <td class="paramname"><span class="paramname"><em>events</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Track signal falling edge interrupt callback function. </p>
<p>Saves timer counter value using get_absolute_time(), then calculates time difference between rising and falling edge. When the time difference is greater than 87us, this bit is interpreted as a logical 0. Refers to NMRA S-9.1 and RCN-210 standards Puts the latest bit value into buffer, then evaluates complete buffer using evaluate_message(). Parameters are unused.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gpio</td><td>Unused parameter </td></tr>
    <tr><td class="paramname">events</td><td>Unused parameter </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9e63f26cc0e48c67410c6729a3798126" name="a9e63f26cc0e48c67410c6729a3798126"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e63f26cc0e48c67410c6729a3798126">&#9670;&#160;</a></span>track_signal_rise()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void track_signal_rise </td>
          <td>(</td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>gpio</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long unsigned int</td>          <td class="paramname"><span class="paramname"><em>events</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Track signal rising edge interrupt callback function. </p>
<p>Saves timer counter value using get_absolute_time(), then disables rising edge IRQ and enables falling edge IRQ. Parameters are unused.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gpio</td><td>Unused parameter </td></tr>
    <tr><td class="paramname">events</td><td>Unused parameter </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8db7b95e52c5a24409a057b5354aacac" name="a8db7b95e52c5a24409a057b5354aacac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8db7b95e52c5a24409a057b5354aacac">&#9670;&#160;</a></span>two_std_dev()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float two_std_dev </td>
          <td>(</td>
          <td class="paramtype">const float</td>          <td class="paramname"><span class="paramname"><em>arr</em></span>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function returns average of values deviating less than twice the standard deviation from original average. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arr</td><td>input array </td></tr>
    <tr><td class="paramname">length</td><td>amount of elements in input array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>average value of values deviating less than 2*standard_dev. </dd></dl>

</div>
</div>
<a id="afc9694833148886687130bfc41c0278b" name="afc9694833148886687130bfc41c0278b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc9694833148886687130bfc41c0278b">&#9670;&#160;</a></span>verify_cv_bit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void verify_cv_bit </td>
          <td>(</td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>cv_address</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>bit_val</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>bit_pos</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for verifying a single bit of a CV. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cv_address</td><td>CV Address </td></tr>
    <tr><td class="paramname">bit_val</td><td>Value of bit to be verified </td></tr>
    <tr><td class="paramname">bit_pos</td><td>Position of bit to be verified </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a28319b022b8ee5ff0a38ef2581a4967e" name="a28319b022b8ee5ff0a38ef2581a4967e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28319b022b8ee5ff0a38ef2581a4967e">&#9670;&#160;</a></span>verify_cv_byte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void verify_cv_byte </td>
          <td>(</td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>cv_address</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>cv_data</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for verifying a CV byte. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cv_address</td><td>CV Address </td></tr>
    <tr><td class="paramname">cv_data</td><td>Byte to be verified </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a19046d77097b4236a15890613d6f5300" name="a19046d77097b4236a15890613d6f5300"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19046d77097b4236a15890613d6f5300">&#9670;&#160;</a></span>write_cv_byte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void write_cv_byte </td>
          <td>(</td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>cv_address</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>cv_data</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for writing a CV byte. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cv_address</td><td></td></tr>
    <tr><td class="paramname">cv_data</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a3cb7d222f559f6157b67e5b778b3752d" name="a3cb7d222f559f6157b67e5b778b3752d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cb7d222f559f6157b67e5b778b3752d">&#9670;&#160;</a></span>clr_bit_arr</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const uint32_t clr_bit_arr[6]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">        0b11111111111111111111111111100000, </div>
<div class="line">        0b11111111111111111111111000011111, </div>
<div class="line">        0b11111111111111111110000111111111, </div>
<div class="line">        0b11111111111000000001111111111111, </div>
<div class="line">        0b11100000000111111111111111111111, </div>
<div class="line">        0b00011111111111111111111111111111, </div>
<div class="line">}</div>
</div><!-- fragment -->
<p>Bitmasks used for clearing bits corresponding to function blocks. </p>
<p>[0] = F0-F4 [1] = F5-F8 [2] = F9-F12 [3] = F13-F20 [4] = F21-F28 [5] = F29-F31 </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
